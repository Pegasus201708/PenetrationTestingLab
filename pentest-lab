#!/bin/bash

labs_list=(
  "bwapp"
  "webgoat7"
  "webgoat8"
  "webgoat81"
  "dvwa"
  "mutillidae"
  "juiceshop"
  "vulnerablewordpress"
  "securityninjas"
  "altoro"
  "graphql"
  "securitysheperd"
)

options=(
  "Enter the Lab"
  "Install the LAB"
  "Show Running LABS"
)

# Function to display the banner
display_banner() {
    echo "Welcome to Hacker's Lab"
}

# Function to display the menu options
display_menu() {
    echo "Select an option:"
    for ((i=0; i<${#options[@]}; i++)); do
        echo "$((i+1)). ${options[i]}"
    done
}

# Function to display the list of labs
display_lab_list() {
    echo "Lab List:"
     echo "Available pentest applications" >&2
    echo "  bwapp 		- bWAPP PHP/MySQL based from itsecgames.com"
    echo "  webgoat7		- OWASP WebGoat 7.1"
    echo "  webgoat8		- OWASP WebGoat 8.0"
    echo "  webgoat81		- OWASP WebGoat 8.1"
    echo "  dvwa     		- Damn Vulnerable Web Application"
    echo "  mutillidae		- OWASP Mutillidae II"
    echo "  juiceshop		- OWASP Juice Shop"
    echo "  vulnerablewordpress	- WPScan Vulnerable Wordpress"
    echo "  securityninjas	- OpenDNS Security Ninjas"
    echo "  altoro		- Altoro Mutual Vulnerable Bank"
    echo "  graphql		- Vulnerable GraphQL API"

    echo "  securitysheperd	- OWASP Security Sheperd"
    echo
    for ((i=0; i<${#labs_list[@]}; i++)); do
        echo "$((i+1)). ${labs_list[i]}"
    done
}

# Function to display the actions for selected lab
display_lab_actions() {
    echo "Select an action for the lab:"
    echo "1. Start Locally"
    echo "2. Start Publicly"
    echo "3. Start in a Specific Port"
    echo "4. Stop the Lab"
}

# Function to display main options
function display_main_options() {
  display_menu
  read -p "Enter your choice: " selected_option
}

# Function to validate user input
function validate_input() {
  if [[ $1 -lt 1 || $1 -gt ${#options[@]} ]]; then
    echo "Invalid option. Please select a number between 1 and ${#options[@]}."
    exit 1
  fi
}

# Function to handle "Enter the Lab" option
function enter_the_lab() {
  display_lab_list
  read -p "Select a lab: " lab_choice
  case $lab_choice in
    1) 
      select_lab_action "${labs_list[0]}"
      ;;
    2) 
      select_lab_action "${labs_list[1]}"
      ;;
    3) 
      select_lab_action "${labs_list[2]}"
      ;;
    4) 
      select_lab_action "${labs_list[3]}"
      ;;
    5) 
      select_lab_action "${labs_list[4]}"
      ;;
    6) 
      select_lab_action "${labs_list[5]}"
      ;;
    7) 
      select_lab_action "${labs_list[6]}"
      ;;
    8) 
      select_lab_action "${labs_list[7]}"
      ;;
    9) 
      select_lab_action "${labs_list[8]}"
      ;;
    10) 
      select_lab_action "${labs_list[9]}"
      ;;
    *) 
      echo "Invalid lab choice"
      ;;
  esac
}

# Function to handle Lab actions
function select_lab_action() {
  local lab_name="$1"
  echo lab_name
  display_lab_actions
  read -p "Select an action for $lab_name (1-4): " lab_action

  case $lab_action in
    1)
      echo "Starting $lab_name Locally..."
      pentestlab.sh start "$lab_name"
 #     xdg-open "http://$lab_name"
      ;;
    2)
      echo "Starting $lab_name Publicly..."
      pentestlab.sh startpublic "$lab_name"
      ;;
    3)
      read -p "Enter the port number for $lab_name: " port_number
      echo "Starting $lab_name on port $port_number..."
      pentestlab.sh startpublic "$lab_name" "$port_number"
      ;;
    4)
      echo "Stopping $lab_name..."
      pentestlab.sh stop "$lab_name"
      ;;
    *)
      echo "Invalid option. Please select a number between 1 and 4."
      exit 1
      ;;
  esac
}

# Function to handle "Show Running Labs" option
function show_running_labs() {
  echo "Showing Running Labs:"
  pentestlab.sh status
}

# Function to handle "Install the LAB" option
function install_lab() {
  echo "Installing the LAB..."
  sudo cp pentest-lab /usr/local/bin
  git clone https://github.com/eystsen/pentestlab.git
  cd pentestlab
  sudo cp pentestlab.sh /usr/local/bin
  sudo apt -y update
  sudo -y apt ful-upgrade --fix-missing
  sudo apt install docker.io
  
}

# Main script execution
display_banner
display_main_options
validate_input $selected_option

case ${options[$selected_option-1]} in
  "Enter the Lab")
    enter_the_lab
    ;;
  "Install the LAB")
    install_lab
    ;;
  "Show Running LABS")
    show_running_labs
    ;;
  *)
    echo "Option not yet implemented."
    ;;
esac
